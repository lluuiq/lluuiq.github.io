---
title: 博客与服务器同步
date: 2020-02-23 01:17:44 
comments: true
toc: true
top: false

categories: 
- [笔记,博客]
tags: [博客,hexo,github]
---
# 前言

<!-- more -->

# 将源代码保存到github

## 创建分支

在仓库中的文件列表的左上方，点击Branch。

![mark](http://blogimg.wa2000.cn/blog/20200220/vKjTkYWrK8KD.png?imageslim)

搜索 source （分支名，自定义），会提示未找到，是否创建，点击即可创建该分支

![mark](http://blogimg.wa2000.cn/blog/20200220/AQ6FixHkRjvU.png?imageslim)

## 设置新建分支为默认分支

进入设置，左边的列表中选择 Branches，默认分支为master，改为新建的分支，然后点击Update更新。

![mark](http://blogimg.wa2000.cn/blog/20200220/7pI4wicXk16d.png?imageslim)

## 设置同步

首先随便找个地方新建一个文件夹，将你的仓库克隆下来。

打开新建的文件夹，右键空白处点击`Git Bash Here`

然后输入下方命令克隆文件

```
git clone 【你的仓库地址】
```

仓库地址获取方法：

![mark](http://blogimg.wa2000.cn/blog/20200223/Q1pkl9KP2JBF.png?imageslim)

点击红框内的按钮复制，然后粘贴到clone后面即可，用空格与clone隔开。

克隆完成后，该文件夹内会出现`【你的用户名】.github.io`文件夹，进去拷贝`.git`文件夹到本地的博客根目录，然后这个新建的文件夹就可以删除了。

接下来在博客根目录右键空白处，打开git bash，输入下方命令，警告不用理会，若没出现报错就没问题。

会需要github的帐号密码，填一下就OK了。

```
git remote add origin 【你的仓库地址】
git add .
git commit -m "【描述，随便写】"
git push origin 【你的保存源代码的分支名】
```

描述部分的效果如图，会将内容显示在该分支上。

![mark](http://blogimg.wa2000.cn/blog/20200223/GggAj5iv7u21.png?imageslim)

每次推送时，输入的描述都会在这次推送时更新的文件后面显示出来。

接下来每次想保存时，输入下方指令即可，

```
git add .
git commit -m "【描述】"
git push
```

但每次都要输入这么多很麻烦，可以创建一个脚本文件，在博客根目录下新建一个txt文本文件，名字随意自己能知道是保存用的就行，将上方三条指令写进去，描述写好后以后固定都是这个，然后将文件改为`.sh`结尾。这样以后每次点一下这个脚本文件就会自动执行上面三条指令，完成推送。

# 将博客同步到服务器

## 在服务器上部署hexo

CentOS安装Git参考链接：
https://www.cnblogs.com/imyalost/p/8715688.html

Hexo需要10版本以上才能支持，默认安装的话版本开头为6，需要安装最新版本。

CentOS安装最新版Node.js参考链接：

https://www.jianshu.com/p/4a9449506924

安装hexo指令：

```
npm install hexo-cli -g
```

![mark](http://blogimg.wa2000.cn/blog/20200223/nR89OV9XOOVh.png?imageslim)

警告不用理会。

到想保存博客源代码的地方创建好文件夹，原理同windows下部署，要求该文件夹为空。

因为有用过宝塔面板，我的网站根目录在 www/wwwroot ，所以我打算把源代码放在www目录下，并且给文件夹起名为blog

在目标文件夹中初始化hexo，同windows

```
hexo init
```

在服务器上的hexo根目录已经建成，接下来就是同步github上的源代码仓库，使得当github仓库的文件更新时，服务器上的博客源代码也会同步更新。

## 服务器上的hexo同步github

个人为例：

git项目路径：`gitPath="/www/blog"`

git网址：`gitHttp="https://github.com/lluuiq/lluuiq.github.io.git"`

分支名：`source`

```
#!/bin/bash
echo ""
#输出当前时间
date --date='0 days ago' "+%Y-%m-%d %H:%M:%S"
echo "Start"
#git项目路径
gitPath="【你的博客根目录地址】"
#git 网址
gitHttp="【你的仓库地址】"

echo "Web站点路径：$gitPath"

#判断项目路径是否存在
if [ -d "$gitPath" ]; then
        cd $gitPath
        #判断是否存在git目录
        if [ ! -d ".git" ]; then
                echo "在该目录下克隆 git"
                git clone $gitHttp gittemp
                mv gittemp/.git .
                rm -rf gittemp
        fi
        #拉取最新的项目文件
        git reset --hard origin/【你的分支名】
        git pull
        #设置目录权限
        chown -R www:www $gitPath
        echo "End"
        exit
else
        echo "该项目路径不存在"
        echo "End"
        exit
fi
```

