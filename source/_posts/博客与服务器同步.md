---
title: 博客与服务器同步
date: 2020-02-23 01:17:44 
comments: true
toc: true
top: false

categories: 
- [笔记,博客]
tags: [博客,hexo,github]
---
# 前言

<!-- more -->

# 将源代码保存到github

## 创建分支

在仓库中的文件列表的左上方，点击Branch。

![mark](http://blogimg.wa2000.cn/blog/20200220/vKjTkYWrK8KD.png?imageslim)

搜索 source （分支名，自定义），会提示未找到，是否创建，点击即可创建该分支

![mark](http://blogimg.wa2000.cn/blog/20200220/AQ6FixHkRjvU.png?imageslim)

## 设置新建分支为默认分支

进入设置，左边的列表中选择 Branches，默认分支为master，改为新建的分支，然后点击Update更新。

![mark](http://blogimg.wa2000.cn/blog/20200220/7pI4wicXk16d.png?imageslim)

## 设置同步

首先随便找个地方新建一个文件夹，将你的仓库克隆下来。

打开新建的文件夹，右键空白处点击`Git Bash Here`

然后输入下方命令克隆文件

```
git clone 【你的仓库地址】
```

仓库地址获取方法：

![mark](http://blogimg.wa2000.cn/blog/20200223/Q1pkl9KP2JBF.png?imageslim)

点击红框内的按钮复制，然后粘贴到clone后面即可，用空格与clone隔开。

克隆完成后，该文件夹内会出现`【你的用户名】.github.io`文件夹，进去拷贝`.git`文件夹到本地的博客根目录，然后这个新建的文件夹就可以删除了。

接下来在博客根目录右键空白处，打开git bash，输入下方命令，警告不用理会，若没出现报错就没问题。

会需要github的帐号密码，填一下就OK了。

```
git remote add origin 【你的仓库地址】
git add .
git commit -m "【描述，随便写】"
git push origin 【你的保存源代码的分支名】
```

描述部分的效果如图，会将内容显示在该分支上。

![mark](http://blogimg.wa2000.cn/blog/20200223/GggAj5iv7u21.png?imageslim)

每次推送时，输入的描述都会在这次推送时更新的文件后面显示出来。

接下来每次想保存时，输入下方指令即可，

```
git add .
git commit -m "【描述】"
git push
```

但每次都要输入这么多很麻烦，可以创建一个脚本文件，在博客根目录下新建一个txt文本文件，名字随意自己能知道是保存用的就行，将上方三条指令写进去，描述写好后以后固定都是这个，然后将文件改为`.sh`结尾。也可以直接建一个`.sh`尾缀文件，然后用编辑器打开写入。这样以后每次点一下这个脚本文件就会自动执行上面三条指令，完成推送。

本地同步到github就完成了，但要注意的是只保存了关键文件，如主题、文章、配置等。

node_modules文件夹和public文件夹是没有保存上去的，public文件夹是生成的静态页面，不需要保存，若迁移后直接生成就有了。

node_modules文件夹存放着需要用到的插件，如果想保存的话，打开`.gitignore`文件，把里面的node_modules删掉保存即可，但是这样会造成每次保存都需要很久时间，因为里面东西太多了，看个人需要决定是否需要保存。

生成的静态页面是会推送到master分支的，只要配置文件里面的deploy里的branch的值是master的话

![mark](http://blogimg.wa2000.cn/blog/20200223/rQWYspvqQ5Su.png?imageslim)

配置完成后，若以后要迁移到其他的服务器或者电脑上，只需要安装好git、Node.js、hexo，然后使用`hexo init`命令初始化一个根目录，再克隆下来就行了，若不指定克隆分支的话，会克隆默认分支，即设置好的保存博客源代码的分支。



# 将博客同步到服务器

## 在服务器上部署hexo

关于CentOS的安装git、Node.js我遇到一些问题，参考了下面两篇文章完美解决，故这里就不说安装方法了，直接看这两篇就行了。

CentOS安装Git参考链接：
https://www.cnblogs.com/imyalost/p/8715688.html

**注**：Hexo需要10版本以上才能支持，默认安装的话版本开头为6，需要安装最新版本才可以，我就用默认安装Node.js的方法结果最后hexo安装失败。

CentOS安装最新版Node.js参考链接：

https://www.jianshu.com/p/4a9449506924

安装hexo指令：

```
npm install hexo-cli -g
```

![mark](http://blogimg.wa2000.cn/blog/20200223/nR89OV9XOOVh.png?imageslim)

警告不用理会。

到想保存博客源代码的地方创建好文件夹，原理同windows下部署，要求该文件夹为空。

因为有用过宝塔面板，我的网站根目录在 www/wwwroot ，所以我打算把源代码放在www目录下，并且给文件夹起名为blog

在目标文件夹中初始化hexo，同windows

```
hexo init
```

在服务器上的hexo根目录已经建成，接下来就是同步github上的源代码仓库，使得当github仓库的文件更新时，服务器上的博客源代码也会同步更新。

## 服务器上的hexo同步github

该过程与将hexo生成的静态页面放在服务器上相同，只需要更改部分内容即可。

宝塔上添加一个新的Webhook，名称还是随意，能分清就行，代码和拉取静态页面的类似，更改几处就行了。

关于之前的配置方法参考另一篇文章的结尾处：通过webhook实现同步部署

代码更改以个人为例，【】的内容为需要更改的地方：

git项目路径：`gitPath="/www/blog"`

git网址：`gitHttp="https://github.com/lluuiq/lluuiq.github.io.git"`

分支名：`source`

```
#!/bin/bash
echo ""
#输出当前时间
date --date='0 days ago' "+%Y-%m-%d %H:%M:%S"
echo "Start"
#git项目路径
gitPath="【你的博客根目录地址】"
#git 网址
gitHttp="【你的仓库地址】"

echo "Web站点路径：$gitPath"

#判断项目路径是否存在
if [ -d "$gitPath" ]; then
        cd $gitPath
        #判断是否存在git目录
        if [ ! -d ".git" ]; then
                echo "在该目录下克隆 git"
                git clone $gitHttp gittemp
                mv gittemp/.git .
                rm -rf gittemp
        fi
        #拉取最新的项目文件
        git reset --hard origin/【你的分支名】
        git pull
        #设置目录权限
        chown -R www:www $gitPath
        echo "End"
        exit
else
        echo "该项目路径不存在"
        echo "End"
        exit
fi
```

配置完钩子后，因为服务器上的博客目录内没有`.git`文件夹，所以还无法拉取。

解决办法有两个：

1. 在服务器上的根目录中克隆仓库，然后把 `【yourusername】.github.io`文件夹内的`.git`文件夹拷贝到博客根目录，然后删掉克隆下来的内容。

2. 将本地的`.git`文件夹上传到服务器上的博客根目录内

第二个方法如果是使用远程链接工具的话会方便一些，只要能传文件就行，下面说第一个方法。

服务器上到博客的根目录中，然后输入命令

```
git clone 【你的仓库地址】
cd 【yourusername】.github.io
cp -r .git ../

```